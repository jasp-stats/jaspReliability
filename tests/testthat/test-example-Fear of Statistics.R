context("Example: Fear of Statistics")

# This test file was auto-generated from a JASP example file.
# The JASP file is stored in the module's examples/ folder.

test_that("unidimensionalReliabilityFrequentist results match", {

  # Load from JASP example file
  jaspFile <- testthat::test_path("..", "..", "examples", "Fear of Statistics.jasp")
  opts <- jaspTools::analysisOptions(jaspFile)
  dataset <- jaspTools::extractDatasetFromJASPFile(jaspFile)

  # Encode and run analysis
  encoded <- jaspTools:::encodeOptionsAndDataset(opts, dataset)
  set.seed(1)
  results <- jaspTools::runAnalysis("unidimensionalReliabilityFrequentist", encoded$dataset, encoded$options, encodedDataset = TRUE)

  table <- results[["results"]][["stateContainer"]][["collection"]][["stateContainer_itemTable"]][["data"]]
  jaspTools::expect_equal_tables(table,
    list(0.789472253800211, 0.507994072635359, 3.59381996636227, 0.805993418667595,
     0.801701054237784, 0.536123322293828, 3.62582652664333, 0.828022142655586,
     0.813929854675356, 0.563110277391259, 3.65783308692439, 0.851297794593357,
     "jaspColumn2", 0.786970395009416, 0.52164787762286, 2.54382166377265,
     1.04641015892343, 0.799599868815589, 0.549229848191858, 2.5853753403345,
     1.07500974799608, 0.812229342621762, 0.575664935637303, 2.62692901689635,
     1.10522820645882, "jaspColumn1", 0.782714309640869, 0.548542560393445,
     3.17725913870004, 0.923313042152352, 0.795501905622937, 0.575006896511016,
     3.21392454297939, 0.94854824592574, 0.808289501605004, 0.600320299112963,
     3.25058994725873, 0.975211879276828, "jaspColumn3", 0.794717880279703,
     0.464673218842772, 3.24042358450416, 0.939025770089386, 0.806645276921489,
     0.49444890453799, 3.27771295215869, 0.964690420727732, 0.818572673563275,
     0.523107664110272, 3.31500231981323, 0.991807809628163, "jaspColumn4",
     0.783502831879572, 0.544913712090671, 2.80510329051121, 0.892094306689308,
     0.796234872333259, 0.571531912115425, 2.84052897705173, 0.916476266638564,
     0.808966912786946, 0.596999331824702, 2.87595466359225, 0.942238358607619,
     "jaspColumn5", 0.780031700512322, 0.571832139483559, 3.08516634173243,
     0.891681904571195, 0.792774069276998, 0.597286287066587, 3.12057565149747,
     0.916052593097854, 0.805516438041674, 0.621591510055801, 3.15598496126251,
     0.941802775629515, "jaspColumn6", 0.807304571360026, 0.386108703858437,
     2.33569312432985, 1.00819595472082, 0.818454540851068, 0.418519409636174,
     2.3757292882147, 1.03575110579025, 0.829604510342111, 0.4498980719029,
     2.41576545209956, 1.06486600621456, "jaspColumn7", 0.77775681346355,
     0.581084459702114, 2.79118587937089, 0.9585185608918, 0.790806823158047,
     0.606126396844851, 2.829249319331, 0.984715971846045, 0.803856832852543,
     0.630021669130276, 2.86731275929111, 1.01239627776727, "jaspColumn8"
    ))

  table <- results[["results"]][["stateContainer"]][["collection"]][["stateContainer_scaleTable"]][["data"]]
  jaspTools::expect_equal_tables(table,
    list("Cronbach's <unicode>", 0.820836210468447, 0.809886136369784,
     0.00558687515945965, 0.831786284567109, "Average interitem correlation",
     0.368244389782582, "", "", "", "Mean", 23.8689225982108, 23.6709221495764,
     0.101022493370379, 24.0669230468452, "SD", 5.1223484899762,
     4.98607338905426, 0.0672550485916684, 5.26633739367179))

})

