context("Example: ADD symptoms")

# This test file was auto-generated from a JASP example file.
# The JASP file is stored in the module's examples/ folder.

test_that("standardErrorOfMeasurement results match", {

  # Load from JASP example file
  jaspFile <- testthat::test_path("..", "..", "examples", "ADD symptoms.jasp")
  opts <- jaspTools::analysisOptions(jaspFile)
  dataset <- jaspTools::extractDatasetFromJASPFile(jaspFile)

  # Encode and run analysis
  encoded <- jaspTools:::encodeOptionsAndDataset(opts, dataset)
  set.seed(1)
  results <- jaspTools::runAnalysis("standardErrorOfMeasurement", encoded$dataset, encoded$options, encodedDataset = TRUE)

  plotName <- results[["results"]][["semMainContainer"]][["collection"]][["semMainContainer_ciPlotsContainer"]][["collection"]][["semMainContainer_ciPlotsContainer_anovaPlot"]][["data"]]
  testPlot <- results[["state"]][["figures"]][[plotName]][["obj"]]
  jaspTools::expect_equal_plots(testPlot, "analysis-1_figure-1_anova")

  plotName <- results[["results"]][["semMainContainer"]][["collection"]][["semMainContainer_ciPlotsContainer"]][["collection"]][["semMainContainer_ciPlotsContainer_feldtPlot"]][["data"]]
  testPlot <- results[["state"]][["figures"]][[plotName]][["obj"]]
  jaspTools::expect_equal_plots(testPlot, "analysis-1_figure-2_feldt")

  plotName <- results[["results"]][["semMainContainer"]][["collection"]][["semMainContainer_ciPlotsContainer"]][["collection"]][["semMainContainer_ciPlotsContainer_irtPlot"]][["data"]]
  testPlot <- results[["state"]][["figures"]][[plotName]][["obj"]]
  jaspTools::expect_equal_plots(testPlot, "analysis-1_figure-3_irt-grm")

  plotName <- results[["results"]][["semMainContainer"]][["collection"]][["semMainContainer_ciPlotsContainer"]][["collection"]][["semMainContainer_ciPlotsContainer_mollenkopfFeldtPlot"]][["data"]]
  testPlot <- results[["state"]][["figures"]][[plotName]][["obj"]]
  jaspTools::expect_equal_plots(testPlot, "analysis-1_figure-4_mollenkopf-feldt")

  plotName <- results[["results"]][["semMainContainer"]][["collection"]][["semMainContainer_ciPlotsContainer"]][["collection"]][["semMainContainer_ciPlotsContainer_thorndikePlot"]][["data"]]
  testPlot <- results[["state"]][["figures"]][[plotName]][["obj"]]
  jaspTools::expect_equal_plots(testPlot, "analysis-1_figure-5_thorndike")

  table <- results[["results"]][["semMainContainer"]][["collection"]][["semMainContainer_ciTable"]][["data"]]
  jaspTools::expect_equal_tables(table,
    list(0, -2.13705718242437, -0.27810540741414, -2.70470939299692, 0,
     0, 0, 2.13705718242437, 0.27810540741414, 2.70470939299692,
     0, -0.899595729444997, -1.46057748861379, -1.08744520560434,
     -2.00383050759994, -0.983954644901564, 1, 2.899595729445, 3.46057748861379,
     3.08744520560434, 4.00383050759994, 2.98395464490156, -0.851105268927215,
     -0.707884240765727, -0.794199312469115, -1.2591060533366, -0.622601867449113,
     2, 4.85110526892722, 4.70788424076573, 4.79419931246912, 5.25910605333661,
     4.62260186744911, -0.392943278934577, -1.10821859650971, -0.250789807591356,
     -0.480623123871856, -0.0750444932642456, 3, 6.39294327893458,
     7.10821859650971, 6.25078980759136, 6.48062312387186, 6.07504449326425,
     0.312068236872515, -0.239898251219455, 0.421449946771267, 0.325104941179841,
     0.0274531936984133, 4, 7.68793176312749, 8.23989825121945, 7.57855005322873,
     7.67489505882016, 7.97254680630159, 1.17704241521105, 1.32241224926625,
     1.17725693021716, 1.15356240919374, 0.528920422281946, 5, 8.82295758478895,
     8.67758775073376, 8.82274306978284, 8.84643759080626, 9.47107957771805,
     2.11226041709651, 1.77721092384374, 1.99089197128476, 2.00145233182651,
     2.20487468931218, 6, 9.88773958290349, 10.2227890761563, 10.0091080287152,
     9.99854766817349, 9.79512531068782, 2.82032476359444, 2.7301485733117,
     2.84474311938808, 2.86627063999715, 3.20669099469623, 7, 11.1796752364056,
     11.2698514266883, 11.1552568806119, 11.1337293600028, 10.7933090053038,
     3.82729353258978, 3.66296256899067, 3.72862283722326, 3.74605502790724,
     3.54062320800826, 8, 12.1727064674102, 12.3370374310093, 12.2713771627767,
     12.2539449720928, 12.4593767919917, 4.6945653764474, 4.61141708990427,
     4.6402284725485, 4.63922799833206, 3.7839438548852, 9, 13.3054346235526,
     13.3885829100957, 13.3597715274515, 13.3607720016679, 14.2160561451148,
     5.49416993909055, 5.56981581642556, 5.57225788534738, 5.54449407127463,
     4.62289454095371, 10, 14.5058300609094, 14.4301841835744, 14.4277421146526,
     14.4555059287254, 15.3771054590463, 6.48512690943649, 6.44244492841362,
     6.5256384862807, 6.46076983387433, 6.45377843078336, 11, 15.5148730905635,
     15.5575550715864, 15.4743615137193, 15.5392301661257, 15.5462215692166,
     7.30938215737586, 7.10625248839713, 7.49597754961295, 7.38713478461053,
     8.18120077471562, 12, 16.6906178426241, 16.8937475116029, 16.504022450387,
     16.6128652153895, 15.8187992252844, 8.3574587386518, 8.21398655690771,
     8.48485905461309, 8.32279582997431, 7.45151974747687, 13, 17.6425412613482,
     17.7860134430923, 17.5151409453869, 17.6772041700257, 18.5484802525231,
     9.48774911348543, 9.61348637268797, 9.48680521923662, 9.26706102472511,
     8.95724526752304, 14, 18.5122508865146, 18.386513627312, 18.5131947807634,
     18.7329389752749, 19.042754732477, 10.6659516095765, 10.539218488469,
     10.5008437315274, 10.219319738112, 10.6826792058896, 15, 19.3340483904235,
     19.460781511531, 19.4991562684726, 19.780680261888, 19.3173207941104,
     11.4663409510228, 11.3548479040421, 11.5207091540632, 11.1790273905945,
     12.0662613200138, 16, 20.5336590489772, 20.6451520959579, 20.4792908459368,
     20.8209726094055, 19.9337386799862, 12.2620803058289, 12.2523751397986,
     12.5418016655421, 12.1456935067181, 11.8508643312701, 17, 21.7379196941711,
     21.7476248602014, 21.4581983344579, 21.8543064932819, 22.1491356687299,
     14.2133829888844, 14.0502724138474, 13.559569378323, 13.1188722162813,
     13.9080364099338, 18, 21.7866170111156, 21.9497275861526, 22.440430621677,
     22.8811277837187, 22.0919635900662, 14.777088789195, 14.3478326010103,
     14.5707519999463, 14.0981545907895, 13.7174087964435, 19, 23.222911210805,
     23.6521673989897, 23.4292480000537, 23.9018454092105, 24.2825912035565,
     15.5792276547683, 14.7748867105474, 15.5779720418538, 15.083162374098,
     15.1286242118092, 20, 24.4207723452317, 25.2251132894526, 24.4220279581462,
     24.916837625902, 24.8713757881908, 16.2965239494113, 16.0782208239334,
     16.5860810276808, 16.0735427844752, 16.3234743082789, 21, 25.7034760505887,
     25.9217791760666, 25.4139189723192, 25.9264572155248, 25.6765256917211,
     16.4056921264084, 15.9704371423158, 17.6012300810344, 17.0689641482873,
     17.5362650988465, 22, 27.5943078735916, 28.0295628576842, 26.3987699189656,
     26.9310358517127, 26.4637349011535, 19.1446366630864, 19.3362996861731,
     18.6294980774069, 18.0691121846803, 18.4736570636953, 23, 26.8553633369136,
     26.6637003138269, 27.3705019225931, 27.9308878153197, 27.5263429363047,
     17.4407059227555, 15.4412560056509, 19.6724854675878, 19.0736868035094,
     20.3978347846345, 24, 30.5592940772445, 32.5587439943491, 28.3275145324122,
     28.9263131964906, 27.6021652153655, 20.3276726056777, 20.5554594147838,
     20.7310810087993, 20.0823993103174, 21.109001784008, 25, 29.6723273943223,
     29.4445405852162, 29.2689189912007, 29.9176006896826, 28.890998215992,
     21.3276726056777, 21.5554594147838, 21.8036901103957, 21.0949699357332,
     22.109001784008, 26, 30.6723273943223, 30.4445405852162, 30.1963098896043,
     30.9050300642668, 29.890998215992, 22.1593104630859, 22.464303709821,
     22.8885800066531, 22.1111256245588, 21.6697252837721, 27, 31.8406895369141,
     31.535696290179, 31.1114199933469, 31.8888743754412, 32.3302747162279,
     23.1593104630859, 23.464303709821, 23.9883201044009, 23.1305980336429,
     22.6697252837721, 28, 32.8406895369141, 32.535696290179, 32.0116798955991,
     32.8694019663571, 33.3302747162279, 24.1593104630859, 24.464303709821,
     25.1077952512584, 24.153121698551, 23.6697252837721, 29, 33.8406895369141,
     33.535696290179, 32.8922047487416, 33.846878301449, 34.3302747162279,
     25.1593104630859, 25.464303709821, 26.2544847533251, 25.1784323378726,
     24.6697252837721, 30, 34.8406895369141, 34.535696290179, 33.7455152466749,
     34.8215676621274, 35.3302747162279, 26.1593104630859, 26.464303709821,
     27.4372795179393, 26.2062652713615, 25.6697252837721, 31, 35.8406895369141,
     35.535696290179, 34.5627204820607, 35.7937347286385, 36.3302747162279,
     27.1593104630859, 27.464303709821, 28.6671586533718, 27.2363539344692,
     26.6697252837721, 32, 36.8406895369141, 36.535696290179, 35.3328413466282,
     36.7636460655308, 37.3302747162279, 28.1593104630859, 28.464303709821,
     29.9711649053319, 28.2684284775465, 27.6697252837721, 33, 37.8406895369141,
     37.535696290179, 36.0288350946681, 37.7315715224535, 38.3302747162279,
     29.1593104630859, 29.464303709821, 31.3967283514021, 29.3022144433534,
     28.6697252837721, 34, 38.8406895369141, 38.535696290179, 36.6032716485979,
     38.6977855566466, 39.3302747162279, 30.1593104630859, 30.464303709821,
     33.0562581792142, 30.3374315217442, 29.6697252837721, 35, 39.8406895369141,
     39.535696290179, 36.9437418207858, 39.6625684782558, 40.3302747162279
    ))

  table <- results[["results"]][["semMainContainer"]][["collection"]][["semMainContainer_coefficientTable"]][["data"]]
  jaspTools::expect_equal_tables(table,
    list(0, 37, 1.0903553326904, 0.141893121306208, 1.37997912937754, 0,
     0, 0.969199303879442, 29, 1.25541974649663, 1.06504263449219,
     1.5325947472983, 1, 1.01224035775695, 1.45467227531545, 21,
     1.38159897943287, 1.42563809055136, 1.66283976595694, 2, 1.33808676492827,
     1.73112531949448, 27, 2.09606841192737, 1.65859670546662, 1.77586075628255,
     3, 1.56892908110547, 1.88163241376751, 37, 2.16325314376347,
     1.82582439343574, 1.87498091179596, 4, 2.02684683883813, 1.9505244050115,
     56, 1.87635475944563, 1.95041495656867, 1.9625042200502, 5,
     2.28120496753275, 1.983577052216, 56, 2.15452381240935, 2.04550086651519,
     2.04011282845681, 6, 1.93632400422828, 2.13252655118885, 60,
     2.17853565696531, 2.12006797746696, 2.10908434675799, 7, 1.93539730077946,
     2.12897099146923, 66, 2.21281486048689, 2.17931410804934, 2.1704199697787,
     8, 2.27523404877168, 2.19669068284587, 68, 2.2391140575604,
     2.22441410242271, 2.22492455783124, 9, 2.66130203731211, 2.29893513169163,
     73, 2.26033958711444, 2.25909361068779, 2.27325908224326, 10,
     2.74347156450844, 2.30354900711251, 72, 2.32532592819857, 2.28287945544535,
     2.31597631483565, 11, 2.31954342277545, 2.39321634459772, 70,
     2.49685583521132, 2.29801286447823, 2.35354590787135, 12, 1.94840275403354,
     2.36868702586781, 68, 2.44188846368798, 2.30368567024791, 2.38637250833121,
     13, 2.830909290318, 2.30221112331993, 72, 2.23805828163797,
     2.30269271086759, 2.41480915598843, 14, 2.57288132448023, 2.21128981175669,
     57, 2.27595075558381, 2.29553007298162, 2.43916740286934, 15,
     2.20275516701574, 2.31313385589639, 51, 2.37001910881948, 2.28539446707639,
     2.45972510078387, 16, 2.00704641055399, 2.41735038579444, 34,
     2.42230209210479, 2.27463278387952, 2.47673249690914, 17, 2.62715830971674,
     1.93198295529098, 43, 2.01520416564159, 2.26556745771994, 2.49041708022207,
     18, 2.0877748888975, 2.15458612715072, 30, 2.37359841083073,
     2.25986193368399, 2.50098749154352, 19, 2.69524911948635, 2.25553754053755,
     32, 2.66592311423455, 2.25617817114322, 2.50863672224864, 20,
     2.4854414808719, 2.39977677533319, 28, 2.51115796764072, 2.25204085745228,
     2.51354476632433, 21, 2.38602633956997, 2.85429115928597, 14,
     3.07636410936357, 2.24431160657161, 2.51588084812177, 22, 2.27745761471277,
     1.96705825582726, 12, 1.86926920225357, 2.22988889442209, 2.51580531796194,
     23, 2.3094010767585, 3.3466401061363, 10, 4.36678636028997,
     2.20795614947372, 2.51347128587501, 24, 1.83787316694536, 2.38388431174097,
     9, 2.26766441642508, 2.17805991583181, 2.50902604765804, 25,
     1.98523965066897, 2.38388431174097, 8, 2.26766441642508, 2.14101377510213,
     2.50261234540895, 26, 1.98523965066897, 2.46978494252792, 13,
     2.31417328377257, 2.09770180767468, 2.4943694955642, 27, 2.71957788932472,
     2.46978494252792, 2, 2.31417328377257, 2.04681306760873, 2.48443441041076,
     28, 2.71957788932472, 2.46978494252792, 1, 2.31417328377257,
     1.98585523991403, 2.47294253347537, 29, 2.71957788932472, 2.46978494252792,
     1, 2.31417328377257, 1.91101228197, 2.46002870469016, 30, 2.71957788932472,
     2.46978494252792, 3, 2.31417328377257, 1.81774793320847, 2.44582796747842,
     31, 2.71957788932472, 2.46978494252792, 0, 2.31417328377257,
     1.70046050484461, 2.43047632665999, 32, 2.71957788932472, 2.46978494252792,
     1, 2.31417328377257, 1.54535242410534, 2.41411146315725, 33,
     2.71957788932472, 2.46978494252792, 0, 2.31417328377257, 1.32822422714509,
     2.39687340874737, 34, 2.71957788932472, 2.46978494252792, 1,
     2.31417328377257, 0.99172323375212, 2.3789051814388, 35, 2.71957788932472
    ))

  plotName <- results[["results"]][["semMainContainer"]][["collection"]][["semMainContainer_combinedPlot"]][["data"]]
  testPlot <- results[["state"]][["figures"]][[plotName]][["obj"]]
  jaspTools::expect_equal_plots(testPlot, "analysis-1_figure-6_combined-plot")

  plotName <- results[["results"]][["semMainContainer"]][["collection"]][["semMainContainer_histPlot"]][["data"]]
  testPlot <- results[["state"]][["figures"]][[plotName]][["obj"]]
  jaspTools::expect_equal_plots(testPlot, "analysis-1_figure-7_histogram-of-counts-per-sum-score-group")

  plotName <- results[["results"]][["semMainContainer"]][["collection"]][["semMainContainer_pointPlotsContainer"]][["collection"]][["semMainContainer_pointPlotsContainer_anovaPlot"]][["data"]]
  testPlot <- results[["state"]][["figures"]][[plotName]][["obj"]]
  jaspTools::expect_equal_plots(testPlot, "analysis-1_figure-8_anova")

  plotName <- results[["results"]][["semMainContainer"]][["collection"]][["semMainContainer_pointPlotsContainer"]][["collection"]][["semMainContainer_pointPlotsContainer_feldtPlot"]][["data"]]
  testPlot <- results[["state"]][["figures"]][[plotName]][["obj"]]
  jaspTools::expect_equal_plots(testPlot, "analysis-1_figure-9_feldt")

  plotName <- results[["results"]][["semMainContainer"]][["collection"]][["semMainContainer_pointPlotsContainer"]][["collection"]][["semMainContainer_pointPlotsContainer_irtPlot"]][["data"]]
  testPlot <- results[["state"]][["figures"]][[plotName]][["obj"]]
  jaspTools::expect_equal_plots(testPlot, "analysis-1_figure-10_irt-grm")

  plotName <- results[["results"]][["semMainContainer"]][["collection"]][["semMainContainer_pointPlotsContainer"]][["collection"]][["semMainContainer_pointPlotsContainer_mollenkopfFeldtPlot"]][["data"]]
  testPlot <- results[["state"]][["figures"]][[plotName]][["obj"]]
  jaspTools::expect_equal_plots(testPlot, "analysis-1_figure-11_mollenkopf-feldt")

  plotName <- results[["results"]][["semMainContainer"]][["collection"]][["semMainContainer_pointPlotsContainer"]][["collection"]][["semMainContainer_pointPlotsContainer_thorndikePlot"]][["data"]]
  testPlot <- results[["state"]][["figures"]][[plotName]][["obj"]]
  jaspTools::expect_equal_plots(testPlot, "analysis-1_figure-12_thorndike")

})

